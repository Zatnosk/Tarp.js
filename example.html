<!DOCTYPE html>
<html>
<head>
	<title>Microblogging example</title>
	<script src="hawk.js"></script>
	<script src="tarp.js"></script>
</head>
<body>
	<script>
	var app_data = {
		"name": "Tarp.js example",
		"url": "http://tarp.zatnosk.dk",
		"redirect_uri": "http://localhost/example.html",
		"types": {
			"write": ["https://tent.io/types/status/v0"],
			"read": ["https://tent.io/types/status/v0"]
		},
		"scopes": [
			"permissions"
		]
	}
	Tarp.plumbing.discovery = function(entity){
		//This function can be anything that takes an entity URL and returns a CORS-compatible URL, where the meta post can be fetched.
		//tarp.zatnosk.dk/discover.php is a deployment of Tarp-discover.
		//Do not rely on this service for anything other than casual testing.
		return 'http://tarp.zatnosk.dk/discover.php?entity='+entity
	}
	var sessions = Tarp(app_data)
	var app = sessions[0]
	if(!app.entity){
		app.register('https://zatnosk.cupcake.is') //Logins an entity and initiates the redirect
	}
	var feed = app.feed()
	for(var i in feed.posts){
		var p = '<p>'+feed.posts[i].content.text+'<br><span style="font-size:0.8em;">'+feed.posts[i].entity+'</span></p>'
		document.write(p)
	}
	</script>
</body>
</html>

